# í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ (Prim's algorithm)

## 1. í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ì´ë€?

í¬ë£¨ìŠ¤ì¹¼ ì•Œê³ ë¦¬ì¦˜ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ìµœì†Œ ì‹ ì¥ íŠ¸ë¦¬ (MST) ë¥¼ êµ¬í•˜ê¸° ìœ„í•œ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ, ì—­ì‹œ **íƒìš• ì•Œê³ ë¦¬ì¦˜**ì„ ê¸°ì´ˆë¡œ í•œë‹¤.

## 2. í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ vs í¬ë£¨ìŠ¤ì¹¼ ì•Œê³ ë¦¬ì¦˜

[ê³µí†µì ]

- ë‘˜ë‹¤ íƒìš• ì•Œê³ ë¦¬ì¦˜ì„ ê¸°ì´ˆë¡œ í•˜ê³  ìˆìŒ.

[ì°¨ì´ì ]

- í¬ë£¨ìŠ¤ì¹¼ ì•Œê³ ë¦¬ì¦˜ì€ **ì „ì²´ ê°„ì„ ë“¤ ì¤‘ ê°€ì¥ ê°€ì¤‘ì¹˜ê°€ ì‘ì€ ê°„ì„ ë¶€í„° ì‚¬ì´í´ì´ ìƒê¸°ì§€ ì•Šê²Œ ì„ íƒ**í•˜ë©´ì„œ MSTë¥¼ êµ¬í•¨.
- í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ì€ **íŠ¹ì • ì •ì ì—ì„œ ì‹œì‘í•´, í•´ë‹¹ ì •ì ì— ì—°ê²°ëœ ê°„ì„ ë“¤ ì¤‘ ê°€ì¥ ê°€ì¤‘ì¹˜ê°€ ì‘ì€ ê°„ì„ ì„ ì„ íƒ**í•´ê°€ë©° MSTë¥¼ êµ¬í•¨.

## 3. í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ ë™ì‘ ë°©ì‹ ì´í•´

1. ì„ì˜ì˜ ì •ì ì„ ì„ íƒ, **'ì—°ê²°ëœ ë…¸ë“œ ì§‘í•©'**ì— ì‚½ì…
2. ì„ íƒëœ ì •ì ì— ì—°ê²°ëœ ê°„ì„ ë“¤ì„ ê°„ì„  ë¦¬ìŠ¤íŠ¸ì— ì‚½ì…
3. ê°„ì„  ë¦¬ìŠ¤íŠ¸ì—ì„œ ìµœì†Œ ê°€ì¤‘ì¹˜ë¥¼ ê°€ì§€ëŠ” ê°„ì„ ë¶€í„° ì¶”ì¶œí•´ì„œ,
   - í•´ë‹¹ ê°„ì„ ì— ì—°ê²°ëœ ì¸ì ‘ ì •ì ì´ 'ì—°ê²°ëœ ë…¸ë“œ ì§‘í•©'ì— ì´ë¯¸ ë“¤ì–´ ìˆë‹¤ë©´, ìŠ¤í‚µí•¨ (cycle ë°©ì§€)
   - í•´ë‹¹ ê°„ì„ ì— ì—°ê²°ëœ ì¸ì ‘ ì •ì ì´ 'ì—°ê²°ëœ ë…¸ë“œ ì§‘í•©'ì— ë“¤ì–´ ìˆì§€ ì•Šìœ¼ë©´, í•´ë‹¹ ê°„ì„ ì„ ì„ íƒí•˜ê³ , í•´ë‹¹ ê°„ì„  ì •ë³´ë¥¼ **'ìµœì†Œ ì‹ ì¥ íŠ¸ë¦¬'**ì— ì‚½ì…
4. ì¶”ì¶œí•œ ê°„ì„ ì€ ê°„ì„  ë¦¬ìŠ¤íŠ¸ì—ì„œ ì œê±° (pop)
5. **ê°„ì„  ë¦¬ìŠ¤íŠ¸ì— ë” ì´ìƒì˜ ê°„ì„ ì´ ì—†ì„ ë•Œê¹Œì§€** 3-4ë²ˆì„ ë°˜ë³µ

## 4. í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ ì½”ë“œ ì‘ì„±

```python
# ì¤‘ë³µëœ ê°„ì„ ì€ ë¹¼ê³  í‘œí˜„, ë…¸ë“œëŠ” ë³„ë„ë¡œ í‘œí˜„í•  í•„ìš” X
from collections import defaultdict
from heapq import *

myedges = [
    (7, 'A', 'B'), (5, 'A', 'D'), (8, 'B', 'C'), (9, 'B', 'D'), (7, 'B', 'E'),
    (5, 'C', 'E'),
    (7, 'D', 'E'), (6, 'D', 'F'),
    (8, 'E', 'F'), (9, 'E', 'G'),
    (11, 'F', 'G')
]


def prim(start_node, edges):
    adjacent_edges = defaultdict(list)
    mst = list()
    for weight, n1, n2 in edges:
        # ì´ ê³¼ì •ì—ì„œ ìë™ìœ¼ë¡œ ê°„ì„ ë“¤ì´ ì–‘ìª½ ë…¸ë“œì— ì¤‘ë³µìœ¼ë¡œ ì˜ ë“¤ì–´ê°
        adjacent_edges[n1].append((weight, n1, n2))
        adjacent_edges[n2].append((weight, n2, n1))
    connected_nodes = set(start_node)  # ì—°ê²°ëœ ë…¸ë“œë“¤ì„ ì§‘í•© í˜•íƒœë¡œ
    candidate_edge_list = adjacent_edges[start_node]
    heapify(candidate_edge_list)

    while candidate_edge_list:
        weight, n1, n2 = heappop(candidate_edge_list)  # n1ì€ ì›ë˜ ì •ì , n2ê°€ ì¸ì ‘ ì •ì 
        if n2 not in connected_nodes:
            connected_nodes.add(n2)
            mst.append((weight, n1, n2))
            for edge in adjacent_edges[n2]:
                if edge[2] not in connected_nodes:
                    heappush(candidate_edge_list, edge)
    return mst


print(prim('A', myedges))
```

## 5. ì‹œê°„ ë³µì¡ë„

ìµœì•…ì˜ ê²½ìš°, while êµ¬ë¬¸ì—ì„œ ëª¨ë“  ê°„ì„ ì— ëŒ€í•´ ë°˜ë³µí•˜ê³  O(E), í•œ loop ë‹¹ push í•˜ë©° ìµœì†Œ í™ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ëŠ” ë°ì— O(logE) ë§Œí¼ì˜ ì‹œê°„ì´ ê±¸ë¦¬ë¯€ë¡œ (heapì— ëª¨ë“  ê°„ì„ ì´ ë‹¤ ë“¤ì–´ê°ˆ ìµœì•…ì˜ ê²½ìš°) ê²°ê³¼ì ìœ¼ë¡œ O(ElogE) ì‹œê°„ ë³µì¡ë„ë¥¼ ê°€ì§

ê·¸ëŸ°ë° ì¼ë°˜ì ìœ¼ë¡œ í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ì˜ ì‹œê°„ë³µì¡ë„ëŠ” **O(ElogV)** ë¡œ ë‚˜íƒ€ë‚´ëŠ” ê²½ìš°ê°€ ë§ìŒ! ê·¸ ì´ìœ ëŠ” ì•„ë˜ ê°œì„ ëœ í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ì—ì„œ!

## 6. ì°¸ê³  - ê°œì„ ëœ í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜

ê¸°ì¡´ í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ì´ **ê°„ì„ **ì„ ì¤‘ì‹¬ìœ¼ë¡œ candidate_edge_list ë¼ëŠ” ìš°ì„ ìˆœìœ„ íë¥¼ ì ìš©í–ˆë‹¤ë©´, ê°œì„ ëœ í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ì€ **ë…¸ë“œ** ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ìš°ì„ ìˆœìœ„ íë¥¼ ì ìš©í•œë‹¤.

ì–´ë–»ê²Œ ë…¸ë“œë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ í•˜ëŠ”ê°€?
ë…¸ë“œë§ˆë‹¤ **key ê°’**ì„ ë§¤ê²¨ì„œ ì¸ì ‘ ê°„ì„  í›„ë³´ë“¤ì˜ weight ì¤‘ ê°€ì¥ ì‘ì€ ê°’ìœ¼ë¡œ key ê°’ì„ ì—…ë°ì´íŠ¸ í•œë‹¤.
ê°€ì¥ ì‘ì€ keyê°’ì„ ê°€ì§„ ë…¸ë“œë¶€í„° popì„ í•˜ê³ , ì´ë•Œ ê°€ì¥ ì‘ì€ key ê°’ìœ¼ë¡œ ì„ íƒë˜ì—ˆë˜ ì¸ì ‘ ê°„ì„  í›„ë³´ë¥¼ MSTì— ì¶”ê°€í•œë‹¤.

1) ì´ˆê¸°í™” - ë…¸ë“œ:key êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ë†“ê³ , íŠ¹ì • ì •ì ì˜ keyê°’ì€ 0, ì´ì™¸ì˜ ì •ì ë“¤ì˜ keyê°’ì€ ë¬´í•œëŒ€ë¡œ ë†“ìŒ. ëª¨ë“  ì •ì :key ê°’ì€ ìš°ì„ ìˆœìœ„ íì— push

2) ê°€ì¥ keyê°’ì´ ì‘ì€ ë…¸ë“œ:keyë¥¼ pop í•œ í›„, (pop í•˜ë¯€ë¡œ í•´ë‹¹ ì •ì :key ì •ë³´ëŠ” ìš°ì„ ìˆœìœ„ íì—ì„œ ì‚­ì œë¨), ( = extract min ë¡œì§) í•´ë‹¹ ë…¸ë“œì˜ ì¸ì ‘ ë…¸ë“œë“¤ì— ëŒ€í•´ key ê°’ê³¼ ì—°ê²°ëœ ê°€ì¤‘ì¹˜ ê°’ì„ ë¹„êµí•˜ì—¬ keyê°’ì´ ì‘ìœ¼ë©´ í•´ë‹¹ ì¸ì ‘ë…¸ë“œ:key ê°’ì„ ê°±ì‹ 

3) ë…¸ë“œ:key ê°’ ê°±ì‹ ì‹œ, ìš°ì„ ìˆœìœ„ íëŠ” **ìµœì†Œ keyê°’ì„ ê°€ì§€ëŠ” ë…¸ë“œ:key ë¥¼** ë£¨íŠ¸ ë…¸ë“œë¡œ ì˜¬ë ¤ë†“ë„ë¡ ì¬êµ¬ì„±í•¨ (decrease key ë¡œì§ì´ë¼ê³  ë¶€ë¦„) > ìš°ë¦¬ëŠ” push í•œ ë…€ì„ë“¤ì„ pop í•  ë•Œ ìµœì†Œê°’ì„ ë¹¼ëŠ” ê²ƒë§Œ ë°°ì› ì§€, ì´ë¯¸ ë“¤ì–´ê°€ ìˆëŠ” ì• ë“¤ì˜ ê°’ì„ ë³€ê²½í–ˆì„ ë•Œë„ í™ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ê²Œë” í•˜ëŠ” ê²ƒì€ ë°°ìš´ ì ì´ ì—†ë‹¤.ğŸ˜¨

ë”°ë¼ì„œ ìš°ì„ ìˆœìœ„ í (ìµœì†Œí™) ì—ì„œ, **ì´ë¯¸ ë“¤ì–´ê°€ ìˆëŠ” ë°ì´í„°ì˜ ê°’ ë³€ê²½** ì‹œ, ìµœì†Œê°’ì„ ê°€ì§€ëŠ” ë°ì´í„°ë¥¼ ë£¨íŠ¸ ë…¸ë“œë¡œ ì˜¬ë ¤ë†“ë„ë¡ ì¬êµ¬ì„±í•˜ëŠ” ê¸°ëŠ¥ > heapdict ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ í•´ë‹¹ ê¸°ëŠ¥ì„ ê°„ë‹¨íˆ êµ¬í˜„í•  ê²ƒ!

### ê°œì„ ëœ í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ ì½”ë“œ êµ¬í˜„

```python
from heapdict import heapdict

mygraph = {
    'A': {'B': 7, 'D': 5},
    'B': {'A': 7, 'D': 9, 'C': 8, 'E': 7},
    'C': {'B': 8, 'E': 5},
    'D': {'A': 5, 'B': 9, 'E': 7, 'F': 6},
    'E': {'B': 7, 'C': 5, 'D': 7, 'F': 8, 'G': 9},
    'F': {'D': 6, 'E': 8, 'G': 11},
    'G': {'E': 9, 'F': 11}
}


def prim(graph, start):
    mst, keys, pi, total_weight = list(), heapdict(), dict(), 0
    for node in graph.keys():
        keys[node] = float('inf')
        pi[node] = None
    keys[start], pi[start] = 0, start

    while keys:
        current_node, current_key = keys.popitem()
        mst.append([pi[current_node], current_node, current_key])
        total_weight += current_key
        for adjacent, weight in mygraph[current_node].items():
            if adjacent in keys and weight < keys[adjacent]:
                keys[adjacent] = weight
                pi[adjacent] = current_node
    return mst, total_weight

```

### ê°œì„ ëœ í”„ë¦¼ ì•Œê³ ë¦¬ì¦˜ ì‹œê°„ë³µì¡ë„

1) ì´ˆê¸°í™” í•˜ëŠ” ë¶€ë¶„: ë…¸ë“œ ê°¯ìˆ˜ ë§Œí¼ ë°˜ë³µí•˜ë¯€ë¡œ O(V)

2) keys ì—ì„œ pop í•˜ë©° MSTë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë¶€ë¶„ : while êµ¬ë¬¸ì€ ë…¸ë“œì˜ ê°¯ìˆ˜ ë§Œí¼ ì‹¤í–‰ë˜ë¯€ë¡œ O(V), ê·¸ ë£¨í”„ ì•ˆì—ì„œ popitem í•œ í›„ í™ì„ ì¬êµ¬ì„±í•˜ëŠ” ë¶€ë¶„ì€ O(logV) ì´ê¸°ì— ì „ì²´ì ìœ¼ë¡œëŠ” O(VlogV)

3) key ê°’ì„ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë¶€ë¶„ : ë£¨í”„ í•œë²ˆ ë‹¹ í•´ë‹¹ ë…¸ë“œì— ì—°ê²°ëœ ì¸ì ‘ê°„ì„  ë§Œí¼ ë„ëŠ”ë°, ì „ì²´ì ìœ¼ë¡œ ë³´ë©´ whileê³¼ëŠ” ë³„ê°œë¡œ ê·¸ëƒ¥ O(E) ì„. ê·¸ëŸ°ë° ë…¸ë“œì˜ key ê°’ì„ ê³„ì†í•´ì„œ ì—…ë°ì´íŠ¸í•˜ë©´ ê·¸ ë•Œë§ˆë‹¤ keys ì˜ í™ êµ¬ì¡°ë¥¼ ì¬êµ¬ì„±í•´ì•¼í•¨. ìµœì•…ì˜ ê²½ìš°, í™ êµ¬ì¡° ì•ˆì— ë“¤ì–´ê°€ ìˆì„ ìˆ˜ ìˆëŠ” ë°ì´í„°ì˜ ê°¯ìˆ˜ëŠ” ìµœëŒ€ ë…¸ë“œ ê°¯ìˆ˜ë§Œí¼ì´ë‹ˆ O(logV) ì´ê³ , ë§¤ ê°„ì„  ë§ˆë‹¤ ì—…ë°ì´íŠ¸ê°€ ëœë‹¤ë©´ **O(ElogV)**

ì „ì²´ì ìœ¼ë¡œëŠ” O(V) + O(VlogV) + O(ElogV) ì¸ë°, ì¼ë°˜ì ìœ¼ë¡œ E>V ì´ë¯€ë¡œ (ìµœëŒ€ V^2 = E) ì‹œê°„ë³µì¡ë„ëŠ” O(ElogV) ì„.

## 7. Lesson Learned

### heapq ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©ì„ í†µí•´ ìš°ì„ ìˆœìœ„ í ì‚¬ìš©í•˜ê¸°

ê¸°ì¡´ì— ì‚¬ìš©í–ˆë˜ `heapq.heappush`, `heapq.heappop`

```python
import heapq
queue = []
graph_data = [[2,'A'], [5,'B'], [3,'C']]

# ë°ì´í„°ë¥¼ ì•„ë¬´ë ‡ê²Œë‚˜ íì— ì§‘ì–´ë„£ì–´ë„
for edge in graph_data:
  heapq.heappush(queue,edge)

# heappop ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ popí•˜ë©´ í•­ìƒ ìµœì†Œê°’ì´ popë¨
for index in range(len(queue)):
  print(heapq.heappop(queue))
```

`heapq.heapify` í•¨ìˆ˜ë¥¼ í†µí•´ ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ heap í˜•íƒœë¡œ í•œë²ˆì— ë³€í™˜

```python
import heapq
graph_data = [[2,'A'], [5,'B'], [3,'C']]
# ë³„ë„ì˜ íê°€ í•„ìš” ì—†ìŒ

heapq.heapify(graph_data)
for index in range(len(graph_data)):
  print(heapq.heappop(graph_data))
```

### collections ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ defaultdict í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°

```python
from collections import defaultdict

list_dict = defaultdict(list)
list_dict['key1'] # []
```

ë³„ë„ë¡œ keyì— ëŒ€í•œ valueë¥¼ ì§€ì •í•˜ì§€ ì•Šì•„ë„ (ì´ˆê¸°í™”í•˜ì§€ ì•Šì•„ë„), ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ˆê¸°í™”ë¥¼ í•´ì¤€ë‹¤.

ì›ë˜ëŠ” ë”•ì…”ë„ˆë¦¬ì— ì´ˆê¸°í™” ë˜ì§€ ì•Šì€ key ê°’ì„ í˜¸ì¶œí•˜ë©´ KeyError ì´ ë°œìƒí•˜ë‚˜, defaultdict ë¥¼ ì‚¬ìš©í•˜ë©´ key ê°’ì„ ì´ˆê¸°í™”í•˜ì§€ ì•Šì•„ë„ ì–´ë–¤ keyì— ëŒ€í•´ì„œë„ ë¯¸ë¦¬ ì§€ì •í•´ë‘” ê¸°ë³¸ê°’ì„ valueë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.

```python
from collections import defaultdict

# ì–´ë–¤ ê°’ì„ defaultdictì˜ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸°ëŠëƒì— ë”°ë¼ ê¸°ë³¸ê°’ì´ ë‹¬ë¼ì§
list_dict = defaultdict(int)
list_dict['key1'] # 0

list_dict = defaultdict(str)
list_dict['key1'] # " "
```

